//添加启动task
tasks.whenObjectAdded { task ->
    if (task.name == 'assembleRelease') {
        task.dependsOn removeUselessFiles
    } else if (task.name == "assembleReleaseTest") {
        task.dependsOn removeUselessFiles
    }  else if (task.name == "assembleMonkey") {
        task.dependsOn removeUselessFiles
    } else if (task.name == "assembleMonkeyRelease") {
        task.dependsOn removeUselessFiles
    } else if (task.name == "assembleBeta") {
        task.dependsOn removeUselessFiles
    } else if (task.name == "assembleDebug") {
        task.dependsOn removeUselessFiles
    }
}

task removeUselessFiles() {
    def srcDir = System.getProperty("user.dir") + File.separator + "app" + File.separator + "src"+ File.separator + "main" + File.separator + "assets" + File.separator + "prod";
    def file = new File(srcDir);
    file.listFiles().each {f->
        if (f.isDirectory()) {
            f.deleteDir();
        }
    }
}

task installDebugFile(type: Exec){
    def  purposeDir = "$buildDir/outputs/apk/"
    workingDir  =  "$purposeDir"
    def myCommand = ['adb', 'install', '-r', getApkName("debug")]
    commandLine  myCommand
}

task installDebugApk(type:Exec, dependsOn:installDebugFile){
    def packageName ='gaosi.com.learn'

    commandLine "adb", "shell", "am", "start", "-n", "$packageName/.studentapp.loading.SplashingActivity"
}

def getApkName(buildType) {
    def name = "student_" + buildType + ".apk";

    return name;
}

def deleteDir(file) {
    if (file.exists()) {
       if(file.isDirectory()) {
           file.listFiles().each {f->
               deleteDir(file);
           }
           file.delete();
       } else {
           file.delete();
       }
    }
}